<ng-container>
  <form
    *ngIf="form"
    (ngSubmit)="submit()"
    [formGroup]="form">
    <h2 *ngIf="label">{{ label }}</h2>
    <div [fxLayout]="direction" fxLayoutGap="1rem">
      <ng-container *ngFor="let question of formElements">
        <ng-container [ngSwitch]="getControlType(question)">
          <ng-container *ngSwitchCase="CONTROL_TYPE.FORM_GROUP">
            <slf-dynamic-form-group
              [rootNode]="false"
              [key]="asFormGroupQuestion(question).key"
              [direction]="asFormGroupQuestion(question).direction"
              [label]="asFormGroupQuestion(question).label"
              [form]="groupByKey(asFormGroupQuestion(question).key)"
              [formElements]="asFormGroupQuestion(question).formElements"></slf-dynamic-form-group>
          </ng-container>

          <!-- These are NOT questions! -->
          <ng-container *ngSwitchCase="CONTROL_TYPE.FORM_HINT">
            <slf-form-hint
              [hint]="asFormHint(question).hint"
              [heading]="asFormHint(question).heading"></slf-form-hint>
          </ng-container>

          <ng-container *ngSwitchCase="CONTROL_TYPE.GIST">
            <slf-gist
              [fileGists]="asGist(question).fileGists"></slf-gist>
          </ng-container>

          <ng-container *ngSwitchCase="CONTROL_TYPE.BUTTON">
            <slf-button
              [action]="asButton(question).action"
              [label]="asButton(question).label"
              [icon]="asButton(question).icon"
              [color]="asButton(question).color"
              [raised]="asButton(question).raised"></slf-button>
          </ng-container>

          <!-- Anything not a form group, button, hint or gist, is a question -->
          <ng-container *ngSwitchDefault>
            <slf-dynamic-form-question
              [form]="form"
              (clearArguments)="clearArguments($event)"
              (refreshLinkedQuestion)="refreshLinkedQuestion($event)"
              [question]="asFormQuestion(question)"></slf-dynamic-form-question>
          </ng-container>
        </ng-container>
      </ng-container>
    </div>

    <ng-container *ngIf="showControls">
      <div class="spacer"></div>
      <div
        fxLayout
        fxLayoutGap="1rem">
        <button
          *ngIf="submitButtonBadgeLabel !== undefined"
          mat-raised-button
          [matBadge]="submitButtonBadgeLabel"
          matBadgePosition="below before"
          matBadgeColor="accent"
          color="primary"
          [disabled]="!isValid || disabled"
          type="submit">
          <mat-icon *ngIf="submitButtonIcon">{{ submitButtonIcon }}</mat-icon>
          {{ submitButtonLabel }}
        </button>

        <button
          *ngIf="submitButtonBadgeLabel === undefined"
          mat-raised-button
          color="primary"
          [disabled]="!isValid || disabled"
          type="submit">
          <mat-icon *ngIf="submitButtonIcon">{{ submitButtonIcon }}</mat-icon>
          {{ submitButtonLabel }}
        </button>

        <button
          type="button"
          mat-raised-button
          [disabled]="form.pristine"
          (click)="cancel()">
          {{ cancelButtonLabel }}
        </button>
      </div>
    </ng-container>
    <button
      type="submit"
      style="display: none"></button>
  </form>
</ng-container>
